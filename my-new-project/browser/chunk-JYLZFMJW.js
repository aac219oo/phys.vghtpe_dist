import{a as l,b as S,d as b}from"./chunk-C3NBM3NL.js";import{a as L}from"./chunk-POQ5EUDY.js";import{a as m}from"./chunk-DDGGW3FN.js";import{H as f,R as p,U as c,Wb as E,e as R,i as v,o as u}from"./chunk-FMEZNCYJ.js";var D=class{constructor(){this.author="",this.img="",this.name="",this.id="",this.priceVip=0,this.priceSpecial=0,this.price=0,this.priceFinal=0,this.pubdate="",this.status=""}},P=(()=>{let s=class s{constructor(){this.fields=[{title:"\u4F5C\u8005",from:"bookauthor",to:"author",type:"string"},{title:"\u5716\u7247",from:"bookimg",to:"img",type:"string"},{title:"\u66F8\u540D",from:"bookname",to:"name",type:"string"},{title:"\u66F8\u865F",from:"bookno",to:"id",type:"string"},{title:"VIP \u50F9",from:"bookprcvip",to:"priceVip",type:"number"},{title:"\u7279\u50F9",from:"bookresult",to:"priceSpecial",type:"number"},{title:"\u5B9A\u50F9",from:"bookprice",to:"price",type:"number"},{title:"\u55AE\u50F9\uFF08\u7D50\u5E33\u7528\uFF09",from:"",to:"priceFinal",type:"default-0"},{title:"\u51FA\u7248\u65E5\u671F",from:"bookpubyear",to:"pubdate",type:"string"},{title:"\u5EAB\u5B58\u72C0\u614B",from:"bookstatus",to:"status",type:"string"}]}transformData(e){if(e){var t={};return this.fields.forEach((r,o)=>{switch(r.type){case"number":t[r.to]=Number(e[r.from]);break;case"default-0":t[r.to]||(t[r.to]=0);break;default:t[r.to]=e[r.from];break}}),t}else return new D}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var g=R(L());var k=(()=>{let s=class s{constructor(e){this.us=e,this.fields=[{title:"\u4F7F\u7528\u8005\u5E33\u865F",from:"id",to:"userid",type:"string"},{title:"\u6536\u4EF6\u4EBA",from:"name",to:"realname",type:"string"},{title:"\u96FB\u5B50\u90F5\u4EF6",from:"email",to:"email",type:"string"},{title:"\u96FB\u8A71",from:"tel",to:"cellphone",type:"string"},{title:"\u5BC4\u9001\u5730\u5740",from:"addr",to:"cityandaddr",type:"string"},{title:"\u4ED8\u8CBB\u65B9\u5F0F",from:"PayType",to:"payType",type:"string"},{title:"\u5546\u54C1\u5167\u5BB9",from:"ProdTitle",to:"cart",type:"string"},{title:"\u7E3D\u91D1\u984D",from:"amount",to:"orderTotalPrice",type:"number"},{title:"\u5237\u5361\u72C0\u614B",from:"CardState",to:"cardState",type:"string"},{title:"\u6536\u8CBB\u5B8C\u6210\uFF081\uFF0F0\uFF09",from:"MoneyOK",to:"payed",type:"number"},{title:"\u5099\u8A3B",from:"REMK",to:"note",type:"string"},{title:"\u6298\u50F9\u5238\u5E8F\u865F",from:"cNumber",to:"couponID",type:"string"}]}transformDataToServer(e){var t=e,r={};return this.fields.forEach((o,a)=>{switch(o.type){case"DateString":r[o.from]=t[o.to];break;case"number":o.to=="payed"?r[o.from]=t[o.to]?1:0:r[o.from]=t[o.to];break;default:r[o.from]=t[o.to]?t[o.to]:"";break}}),r.addr=t.city+t.address,r.ProdTitle=JSON.stringify(t.cart),r.name=t.receiver.realname,r.addr=t.receiver.city+t.receiver.address,r.tel=t.receiver.cellphone,r.email=t.receiver.email,r.cNumber=t.coupon.cNumber,r}};s.\u0275fac=function(t){return new(t||s)(c(b))},s.\u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var x=(()=>{let s=class s{constructor(e){this.http=e,this.bookListAPI=m.ApiUrl+"api/BookDetail_List.aspx",this.getPageIindex$=this.http.get("assets/json/page_index.json").pipe(f(1))}getBookData(e){var t=m.ApiUrl+"api/bookDetail.aspx?BookID=";return this.getText(t+e).pipe(f(1),u(r=>r.replace(/\t/g," ")),u(r=>r.replace(/\\(?!\")/g,"\uFF0F")),u(r=>JSON.parse(r)),u(r=>r[0]))}searchSerieBooks(e,t,r,o=void 0){var a={pageIndex:t.toString(),recordsPerPage:r.toString(),type:e};o=="price"&&(a.sort=1),o=="price2"&&(a.sort=2),o=="update"&&(a.sort=3);var h=new URL(this.bookListAPI),d=new URLSearchParams(a);return h.search=d.toString(),this.getText(h.href).pipe(f(1),u(n=>JSON.parse(n)))}searchByKeyword(e,t,r,o){var a={pageIndex:t.toString(),recordsPerPage:r.toString(),AUTHOR:e,BKNAME:e,BookID:e};o&&(a.type="sc");var h=new URL(this.bookListAPI),d=new URLSearchParams(a);return h.search=d.toString(),this.getText(h.href).pipe(f(1),u(n=>n.replace(/\t/g," ")),u(n=>n.replace(/\\(?!\")/g,"\uFF0F")),u(n=>JSON.parse(n)))}get(e){return this.http.get(e)}getText(e){return this.http.get(e,{responseType:"text"})}};s.\u0275fac=function(t){return new(t||s)(c(E))},s.\u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var F=function(i){return i.ATM="ATM \u8F49\u5E33",i.POST_OFFICE="\u90F5\u653F\u5283\u64A5",i.CREDIT_CARD="\u4FE1\u7528\u5361",i.CONVENIENCE_STORE="\u8D85\u5546\u53D6\u8CA8\u4ED8\u6B3E",i}(F||{}),A=class{constructor(){this.realname="",this.cellphone="",this.email="",this.city="",this.address=""}},I=class{constructor(){this.realname=[],this.cellphone=[],this.email=[],this.city=[F.CONVENIENCE_STORE],this.address=[F.CONVENIENCE_STORE]}},C=class{constructor(){this.cNumber="",this.usedBy="",this.value=0}},N=function(i){return i.CANCELED="\u8A02\u55AE\u53D6\u6D88",i.PROCESSING="\u8655\u7406\u4E2D",i.PAYED_DELIVERING="\u5DF2\u6536\u6B3E\uFF0C\u5DF2\u51FA\u8CA8",i.PAYED_NOTIFY="\u5DF2\u6536\u6B3E\uFF0C\u901A\u77E5\u51FA\u8CA8\u4E2D",i.PAYED_RESUPPLY="\u5DF2\u6536\u6B3E\uFF0C\u7F3A\u66F8\u88DC\u8CA8\u4E2D",i.PAYED_DELIVERING_RESUPPLY="\u5DF2\u6536\u6B3E\uFF0C\u5DF2\u51FA\u8CA8(\u90E8\u4EFD\u7F3A\u66F8\u88DC\u8CA8\u4E2D)",i.GETORDER_NOTIFY="\u5DF2\u6536\u8A02\u55AE\uFF0C\u901A\u77E5\u51FA\u8CA8\u4E2D",i.DELIVERING="\u5DF2\u51FA\u8CA8",i.FAILED="\u4EA4\u6613\u5931\u6557",i.NOT_PAYED="\u5C1A\u672A\u6536\u5230\u4ED8\u6B3E",i}(N||{}),T=class{constructor(){this.cart=[],this.productTotalPrice=0,this.productTotalPriceOrigin=0,this.shippingFee=0,this.orderTotalPrice=0,this.orderTime="",this.orderStatus="\u8655\u7406\u4E2D",this.payed=!1,this.payType="",this.receiver=new A,this.userid="",this.coupon=new C}},q=(()=>{let s=class s{constructor(e,t,r,o,a,h,d){this.http=e,this.cs=t,this.cd=r,this.ss=o,this.us=a,this.os=h,this.ds=d,this.uploadOrderAPI=m.ApiUrl+"api/order.aspx",this.userAPI=m.ApiUrl+"api/MemberUser.aspx",this.dateFormat="YYYY-MM-DD",this.cart=[],this.countTotal=0,this.carriage=0,this.isLogin=!1,this.notRequiredReceiverData=new I,this.allNotUseCoupon=!1,this.isCouponBook=!1,this.couponBookPrice=0,this.threeBooksSelected=!1,this.cs.config$.subscribe(n=>this.config=n),this.us.isLogin$.subscribe(n=>{this.isLogin=this.us.isLogin}),this.order=new T,this.countTotal$=new v(this.countTotal),this.payType$=new v(this.order.payType),this.allNotUseCoupon=!1}startFromLocal(){var e=this.ss.getItem(l.CART_EXPIRED_DATE);e&&(0,g.default)(e).isAfter((0,g.default)().format(this.dateFormat))?this.cart=JSON.parse(this.ss.getItem(l.CART)):this.cart=[],this.order.cart=this.cart,this.updateCart()}addToCart(e){var t=this.cd.transformData(e),r=this.cart.filter((o,a)=>t.id==o.book.id);r.length>0?r[0].count+=1:this.cart.push({book:t,count:1,subTotal:0,originSubTotal:0,selected:!1}),this.updateCart()}deleteCartItem(e){var t=-1;this.cart.forEach((r,o)=>{e.book.id==r.book.id&&(t=o)}),t!==-1&&this.cart.splice(t,1),this.updateCart()}getFinalPrice(){}calcSubTotal(){}calcTotal(){}calcShippingFee(e){var t=[],r=0,o=e;t.forEach((a,h)=>{o>=a.min&&o<=a.max&&(this.order.shippingFee=a.value)})}calcOrderPrice(e){this.order.orderTotalPrice=e+this.order.shippingFee}addOrderTime(){this.order.orderTime=(0,g.default)().format("YYYY-MM-DD HH:mm:ss")}addUserID(){this.order.userid=this.us.user?.account?this.us.user.account:""}saveLocalData(){this.ss.setItem(l.CART,JSON.stringify(this.cart)),this.ss.setItem(l.CART_EXPIRED_DATE,(0,g.default)().add(this.config.localCartDays,"days").format(this.dateFormat))}getCountTotal(){this.countTotal=this.cart.reduce((e,t)=>e+t.count,0)}updateCart(){this.getCountTotal(),this.getFinalPrice(),this.calcSubTotal(),this.calcTotal(),this.calcShippingFee(this.order.productTotalPrice),this.calcOrderPrice(this.order.productTotalPrice),this.saveLocalData(),this.countTotal$.next(this.countTotal)}updateReceiver(e){for(var t in this.order.receiver)this.order.receiver[t]=e[t]}isReceiverDataRequired(e,t){return this.notRequiredReceiverData[e]?.indexOf(t)<0}deleteImg(){}iniOrderState(){this.order.orderStatus=N.PROCESSING}transformOrderData(){this.orderToServer=this.os.transformDataToServer(this.order)}uploadOrder$(){var e=new URL(this.uploadOrderAPI),t=this.orderToServer;t=this.reduceData(t);var r=new URLSearchParams(t);return e.search=r.toString(),this.ds.get(e.href).pipe()}reduceData(e){var t=e,r=JSON.parse(e.ProdTitle);return r.forEach(o=>{delete o.book.img,delete o.book.priceVip,delete o.book.priceSpecial,delete o.book.price,delete o.book.priceFinal,delete o.book.pubdate,delete o.book.status,delete o.discountData,delete o.selected}),r.push({book:{name:"\u904B\u8CBB"},count:this.order.shippingFee>0?1:0,subTotal:this.order.shippingFee}),e.ProdTitle=JSON.stringify(r),t}clearCart(){this.cart=[],this.order=new T,this.order.cart=this.cart,this.allNotUseCoupon=!1,this.updateCart()}sendMail(){}};s.\u0275fac=function(t){return new(t||s)(c(E),c(S),c(P),c(l),c(b),c(k),c(x))},s.\u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();export{x as a,q as b};
