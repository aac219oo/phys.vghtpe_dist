import{a as u,b as R,c as A,f as l}from"./chunk-IR2JAVG4.js";import{a as v}from"./chunk-B7CVLRIE.js";import{a as f}from"./chunk-DDGGW3FN.js";import{Rb as y,S as n,V as a,e as N,i as d}from"./chunk-PDCXLAN3.js";var p=class{constructor(){this.author="",this.img="",this.name="",this.id="",this.priceVip=0,this.priceSpecial=0,this.price=0,this.priceFinal=0,this.pubdate="",this.status=""}},I=(()=>{let s=class s{constructor(){this.fields=[{title:"\u4F5C\u8005",from:"bookauthor",to:"author",type:"string"},{title:"\u5716\u7247",from:"bookimg",to:"img",type:"string"},{title:"\u66F8\u540D",from:"bookname",to:"name",type:"string"},{title:"\u66F8\u865F",from:"bookno",to:"id",type:"string"},{title:"VIP \u50F9",from:"bookprcvip",to:"priceVip",type:"number"},{title:"\u7279\u50F9",from:"bookresult",to:"priceSpecial",type:"number"},{title:"\u5B9A\u50F9",from:"bookprice",to:"price",type:"number"},{title:"\u55AE\u50F9\uFF08\u7D50\u5E33\u7528\uFF09",from:"",to:"priceFinal",type:"default-0"},{title:"\u51FA\u7248\u65E5\u671F",from:"bookpubyear",to:"pubdate",type:"string"},{title:"\u5EAB\u5B58\u72C0\u614B",from:"bookstatus",to:"status",type:"string"}]}transformData(e){if(e){var t={};return this.fields.forEach((i,o)=>{switch(i.type){case"number":t[i.to]=Number(e[i.from]);break;case"default-0":t[i.to]||(t[i.to]=0);break;default:t[i.to]=e[i.from];break}}),t}else return new p}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var h=N(R());var S=(()=>{let s=class s{constructor(e){this.us=e,this.fields=[{title:"\u4F7F\u7528\u8005\u5E33\u865F",from:"id",to:"userid",type:"string"},{title:"\u6536\u4EF6\u4EBA",from:"name",to:"realname",type:"string"},{title:"\u96FB\u5B50\u90F5\u4EF6",from:"email",to:"email",type:"string"},{title:"\u96FB\u8A71",from:"tel",to:"cellphone",type:"string"},{title:"\u5BC4\u9001\u5730\u5740",from:"addr",to:"cityandaddr",type:"string"},{title:"\u4ED8\u8CBB\u65B9\u5F0F",from:"PayType",to:"payType",type:"string"},{title:"\u5546\u54C1\u5167\u5BB9",from:"ProdTitle",to:"cart",type:"string"},{title:"\u7E3D\u91D1\u984D",from:"amount",to:"orderTotalPrice",type:"number"},{title:"\u5237\u5361\u72C0\u614B",from:"CardState",to:"cardState",type:"string"},{title:"\u6536\u8CBB\u5B8C\u6210\uFF081\uFF0F0\uFF09",from:"MoneyOK",to:"payed",type:"number"},{title:"\u5099\u8A3B",from:"REMK",to:"note",type:"string"},{title:"\u6298\u50F9\u5238\u5E8F\u865F",from:"cNumber",to:"couponID",type:"string"}]}transformDataToServer(e){var t=e,i={};return this.fields.forEach((o,c)=>{switch(o.type){case"DateString":i[o.from]=t[o.to];break;case"number":o.to=="payed"?i[o.from]=t[o.to]?1:0:i[o.from]=t[o.to];break;default:i[o.from]=t[o.to]?t[o.to]:"";break}}),i.addr=t.city+t.address,i.ProdTitle=JSON.stringify(t.cart),i.name=t.receiver.realname,i.addr=t.receiver.city+t.receiver.address,i.tel=t.receiver.cellphone,i.email=t.receiver.email,i.cNumber=t.coupon.cNumber,i}};s.\u0275fac=function(t){return new(t||s)(a(l))},s.\u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();var E=function(r){return r.ATM="ATM \u8F49\u5E33",r.POST_OFFICE="\u90F5\u653F\u5283\u64A5",r.CREDIT_CARD="\u4FE1\u7528\u5361",r.CONVENIENCE_STORE="\u8D85\u5546\u53D6\u8CA8\u4ED8\u6B3E",r}(E||{}),D=class{constructor(){this.realname="",this.cellphone="",this.email="",this.city="",this.address=""}},b=class{constructor(){this.realname=[],this.cellphone=[],this.email=[],this.city=[E.CONVENIENCE_STORE],this.address=[E.CONVENIENCE_STORE]}},F=class{constructor(){this.cNumber="",this.usedBy="",this.value=0}},P=function(r){return r.CANCELED="\u8A02\u55AE\u53D6\u6D88",r.PROCESSING="\u8655\u7406\u4E2D",r.PAYED_DELIVERING="\u5DF2\u6536\u6B3E\uFF0C\u5DF2\u51FA\u8CA8",r.PAYED_NOTIFY="\u5DF2\u6536\u6B3E\uFF0C\u901A\u77E5\u51FA\u8CA8\u4E2D",r.PAYED_RESUPPLY="\u5DF2\u6536\u6B3E\uFF0C\u7F3A\u66F8\u88DC\u8CA8\u4E2D",r.PAYED_DELIVERING_RESUPPLY="\u5DF2\u6536\u6B3E\uFF0C\u5DF2\u51FA\u8CA8(\u90E8\u4EFD\u7F3A\u66F8\u88DC\u8CA8\u4E2D)",r.GETORDER_NOTIFY="\u5DF2\u6536\u8A02\u55AE\uFF0C\u901A\u77E5\u51FA\u8CA8\u4E2D",r.DELIVERING="\u5DF2\u51FA\u8CA8",r.FAILED="\u4EA4\u6613\u5931\u6557",r.NOT_PAYED="\u5C1A\u672A\u6536\u5230\u4ED8\u6B3E",r}(P||{}),m=class{constructor(){this.cart=[],this.productTotalPrice=0,this.productTotalPriceOrigin=0,this.shippingFee=0,this.orderTotalPrice=0,this.orderTime="",this.orderStatus="\u8655\u7406\u4E2D",this.payed=!1,this.payType="",this.receiver=new D,this.userid="",this.coupon=new F}},$=(()=>{let s=class s{constructor(e,t,i,o,c,g,k){this.http=e,this.cs=t,this.cd=i,this.ss=o,this.us=c,this.os=g,this.ds=k,this.uploadOrderAPI=f.ApiUrl+"api/order.aspx",this.userAPI=f.ApiUrl+"api/MemberUser.aspx",this.dateFormat="YYYY-MM-DD",this.cart=[],this.countTotal=0,this.carriage=0,this.isLogin=!1,this.notRequiredReceiverData=new b,this.allNotUseCoupon=!1,this.isCouponBook=!1,this.couponBookPrice=0,this.threeBooksSelected=!1,this.cs.config$.subscribe(T=>this.config=T),this.us.isLogin$.subscribe(T=>{this.isLogin=this.us.isLogin}),this.order=new m,this.countTotal$=new d(this.countTotal),this.payType$=new d(this.order.payType),this.allNotUseCoupon=!1}startFromLocal(){var e=this.ss.getItem(u.CART_EXPIRED_DATE);e&&(0,h.default)(e).isAfter((0,h.default)().format(this.dateFormat))?this.cart=JSON.parse(this.ss.getItem(u.CART)):this.cart=[],this.order.cart=this.cart,this.updateCart()}addToCart(e){var t=this.cd.transformData(e),i=this.cart.filter((o,c)=>t.id==o.book.id);i.length>0?i[0].count+=1:this.cart.push({book:t,count:1,subTotal:0,originSubTotal:0,selected:!1}),this.updateCart()}deleteCartItem(e){var t=-1;this.cart.forEach((i,o)=>{e.book.id==i.book.id&&(t=o)}),t!==-1&&this.cart.splice(t,1),this.updateCart()}getFinalPrice(){}calcSubTotal(){}calcTotal(){}calcShippingFee(e){var t=[],i=0,o=e;t.forEach((c,g)=>{o>=c.min&&o<=c.max&&(this.order.shippingFee=c.value)})}calcOrderPrice(e){this.order.orderTotalPrice=e+this.order.shippingFee}addOrderTime(){this.order.orderTime=(0,h.default)().format("YYYY-MM-DD HH:mm:ss")}addUserID(){this.order.userid=this.us.user?.account?this.us.user.account:""}saveLocalData(){this.ss.setItem(u.CART,JSON.stringify(this.cart)),this.ss.setItem(u.CART_EXPIRED_DATE,(0,h.default)().add(this.config.localCartDays,"days").format(this.dateFormat))}getCountTotal(){this.countTotal=this.cart.reduce((e,t)=>e+t.count,0)}updateCart(){this.getCountTotal(),this.getFinalPrice(),this.calcSubTotal(),this.calcTotal(),this.calcShippingFee(this.order.productTotalPrice),this.calcOrderPrice(this.order.productTotalPrice),this.saveLocalData(),this.countTotal$.next(this.countTotal)}updateReceiver(e){for(var t in this.order.receiver)this.order.receiver[t]=e[t]}isReceiverDataRequired(e,t){return this.notRequiredReceiverData[e]?.indexOf(t)<0}deleteImg(){}iniOrderState(){this.order.orderStatus=P.PROCESSING}transformOrderData(){this.orderToServer=this.os.transformDataToServer(this.order)}uploadOrder$(){var e=new URL(this.uploadOrderAPI),t=this.orderToServer;t=this.reduceData(t);var i=new URLSearchParams(t);return e.search=i.toString(),this.ds.get(e.href).pipe()}reduceData(e){var t=e,i=JSON.parse(e.ProdTitle);return i.forEach(o=>{delete o.book.img,delete o.book.priceVip,delete o.book.priceSpecial,delete o.book.price,delete o.book.priceFinal,delete o.book.pubdate,delete o.book.status,delete o.discountData,delete o.selected}),i.push({book:{name:"\u904B\u8CBB"},count:this.order.shippingFee>0?1:0,subTotal:this.order.shippingFee}),e.ProdTitle=JSON.stringify(i),t}clearCart(){this.cart=[],this.order=new m,this.order.cart=this.cart,this.allNotUseCoupon=!1,this.updateCart()}sendMail(){}};s.\u0275fac=function(t){return new(t||s)(a(y),a(A),a(I),a(u),a(l),a(S),a(v))},s.\u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"});let r=s;return r})();export{$ as a};
